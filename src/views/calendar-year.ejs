<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        <%= title %> - Addiction Tracker
    </title>
    <link rel="stylesheet" href="/css/style.css">
    <style>
        .calendar-year-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .calendar-year-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .calendar-year-header h1 {
            color: #667eea;
            margin-bottom: 0.5rem;
        }

        .year-navigation {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .year-nav-btn {
            padding: 0.5rem 1rem;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            text-decoration: none;
            font-weight: 600;
        }

        .year-nav-btn:hover {
            background: #5a6fd6;
        }

        .year-display {
            font-size: 1.5rem;
            font-weight: bold;
            color: #333;
            min-width: 100px;
            text-align: center;
        }

        .view-toggle {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
        }

        .view-toggle a {
            padding: 0.5rem 1rem;
            background: #f0f0f0;
            color: #333;
            border-radius: 5px;
            text-decoration: none;
            font-weight: 600;
        }

        .view-toggle a.active {
            background: #667eea;
            color: white;
        }

        .view-toggle a:hover:not(.active) {
            background: #e0e0e0;
        }

        .year-stats {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .year-stat {
            text-align: center;
            padding: 1rem 1.5rem;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .year-stat-value {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .year-stat-label {
            font-size: 0.85rem;
            color: #666;
        }

        .year-stat.clean .year-stat-value {
            color: #28a745;
        }

        .year-stat.slip .year-stat-value {
            color: #e74c3c;
        }

        .year-stat.total .year-stat-value {
            color: #667eea;
        }

        .months-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
        }

        .month-card {
            background: white;
            border-radius: 10px;
            padding: 1rem;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .month-card-header {
            text-align: center;
            margin-bottom: 0.75rem;
        }

        .month-card-header a {
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
            font-size: 1.1rem;
        }

        .month-card-header a:hover {
            text-decoration: underline;
        }

        .mini-calendar {
            width: 100%;
        }

        .mini-weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            text-align: center;
            font-size: 0.7rem;
            color: #999;
            margin-bottom: 0.25rem;
        }

        .mini-days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 2px;
        }

        .mini-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            border-radius: 4px;
            text-decoration: none;
            color: inherit;
        }

        .mini-day.clean {
            background-color: #d4edda;
            color: #155724;
        }

        .mini-day.slip {
            background-color: #f8d7da;
            color: #721c24;
        }

        .mini-day.no-data {
            background-color: #f9f9f9;
            color: #999;
        }

        .mini-day.empty {
            background: transparent;
        }

        .mini-day:hover:not(.empty) {
            opacity: 0.8;
            transform: scale(1.1);
        }

        .legend {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            margin-top: 2rem;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }

        .back-link {
            display: block;
            text-align: center;
            margin-top: 2rem;
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
        }

        .back-link:hover {
            text-decoration: underline;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .calendar-year-container {
                padding: 15px;
            }

            .year-stats {
                gap: 1rem;
            }

            .year-stat {
                padding: 0.75rem 1rem;
            }

            .months-grid {
                grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
                gap: 1rem;
            }

            .mini-day {
                font-size: 0.65rem;
            }
        }

        @media (max-width: 480px) {
            .months-grid {
                grid-template-columns: 1fr;
            }

            .year-navigation {
                gap: 0.5rem;
            }

            .year-display {
                font-size: 1.25rem;
            }
        }
    </style>
</head>

<body>
    <%- include('partials/header') %>

        <div class="calendar-year-container">
            <div class="calendar-year-header">
                <h1>üìÖ Yearly Calendar</h1>
            </div>

            <div class="view-toggle">
                <a href="/calendar">Monthly View</a>
                <a href="/calendar/year/<%= year %>" class="active">Yearly View</a>
            </div>

            <div class="year-navigation">
                <a href="/calendar/year/<%= year - 1 %>" class="year-nav-btn">‚Üê <%= year - 1 %></a>
                <span class="year-display">
                    <%= year %>
                </span>
                <a href="/calendar/year/<%= year + 1 %>" class="year-nav-btn">
                    <%= year + 1 %> ‚Üí
                </a>
            </div>

            <% if (error) { %>
                <div class="error-message">
                    <%= error %>
                </div>
                <% } else { %>

                    <div class="year-stats">
                        <div class="year-stat clean">
                            <div class="year-stat-value">üü¢ <%= stats.cleanDays %>
                            </div>
                            <div class="year-stat-label">Clean Days</div>
                        </div>
                        <div class="year-stat slip">
                            <div class="year-stat-value">üî¥ <%= stats.slipDays %>
                            </div>
                            <div class="year-stat-label">Just a Little Bit Days</div>
                        </div>
                        <div class="year-stat total">
                            <div class="year-stat-value">üìä <%= stats.totalDays %>
                            </div>
                            <div class="year-stat-label">Total Logged</div>
                        </div>
                    </div>

                    <div class="months-grid">
                        <% yearCalendar.forEach(monthData=> { %>
                            <div class="month-card">
                                <div class="month-card-header">
                                    <a href="/calendar/<%= year %>/<%= monthData.month %>">
                                        <%= monthData.monthName %>
                                    </a>
                                </div>
                                <div class="mini-calendar">
                                    <div class="mini-weekdays">
                                        <div>S</div>
                                        <div>M</div>
                                        <div>T</div>
                                        <div>W</div>
                                        <div>T</div>
                                        <div>F</div>
                                        <div>S</div>
                                    </div>
                                    <div class="mini-days">
                                        <% monthData.calendar.forEach(week=> { %>
                                            <% week.forEach(dayObj=> { %>
                                                <% if (dayObj) { %>
                                                    <a href="/entries/<%= dayObj.date %>"
                                                        class="mini-day <%= dayObj.status %>"
                                                        title="<%= dayObj.date %>: <%= dayObj.status === 'clean' ? 'Clean' : (dayObj.status === 'slip' ? 'Just a Little Bit' : 'No entry') %>">
                                                        <%= dayObj.day %>
                                                    </a>
                                                    <% } else { %>
                                                        <div class="mini-day empty"></div>
                                                        <% } %>
                                                            <% }); %>
                                                                <% }); %>
                                    </div>
                                </div>
                            </div>
                            <% }); %>
                    </div>

                    <div class="legend">
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #d4edda;"></div>
                            <span>üü¢ Clean</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #f8d7da;"></div>
                            <span>üî¥ Just a Little Bit</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #f9f9f9;"></div>
                            <span>‚ö™ No Log</span>
                        </div>
                    </div>

                    <% } %>

                        <a href="/dashboard" class="back-link">‚Üê Back to Dashboard</a>
        </div>

        <%- include('partials/footer') %>
</body>

</html>