<header class="navbar">
    <div class="navbar-container">
        <div class="logo">
            <a href="/">ğŸ§  Addiction Tracker</a>
        </div>
        <div class="hamburger" id="hamburger">
            <span></span>
            <span></span>
            <span></span>
        </div>
        <nav class="nav-menu" id="navMenu">
            <% if (isAuthenticated) { %>
                <ul>
                    <li><a href="/dashboard">ğŸ“Š Dashboard</a></li>
                    <li><a href="/entries">ğŸ“ Log Entry</a></li>
                    <li><a href="/calendar">ğŸ“… Calendar</a></li>
                    <li><a href="/summary">ğŸ“ˆ Summary</a></li>
                    <% if (isAdmin) { %>
                        <li><a href="/admin">ğŸ‘‘ Admin</a></li>
                        <% } %>
                            <li>
                                <button class="theme-toggle" id="themeToggle" title="Toggle theme">
                                    <span class="icon-sun">â˜€ï¸</span>
                                    <span class="icon-moon">ğŸŒ™</span>
                                </button>
                            </li>
                            <li>
                                <form method="POST" action="/logout" style="display: inline;">
                                    <button type="submit" class="logout-link">ğŸšª Logout</button>
                                </form>
                            </li>
                </ul>
                <% } else { %>
                    <ul>
                        <li><a href="/">ğŸ  Home</a></li>
                        <li><a href="/login">ğŸ” Login</a></li>
                        <li><a href="/signup">âœï¸ Sign Up</a></li>
                        <li>
                            <button class="theme-toggle" id="themeToggle" title="Toggle theme">
                                <span class="icon-sun">â˜€ï¸</span>
                                <span class="icon-moon">ğŸŒ™</span>
                            </button>
                        </li>
                    </ul>
                    <% } %>
        </nav>
    </div>
</header>

<script>
    // Theme Toggle
    (function() {
        const themeToggle = document.getElementById('themeToggle');
        const html = document.documentElement;
        
        // Get saved theme or default to light
        const savedTheme = localStorage.getItem('theme') || 'light';
        html.setAttribute('data-theme', savedTheme);
        
        if (themeToggle) {
            themeToggle.addEventListener('click', () => {
                const currentTheme = html.getAttribute('data-theme');
                const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                
                html.setAttribute('data-theme', newTheme);
                localStorage.setItem('theme', newTheme);
            });
        }
    })();

    // Auto-detect timezone and set cookie
    (function () {
        const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
        const cookieTimezone = document.cookie.split('; ').find(row => row.startsWith('timezone='));
        const currentTz = cookieTimezone ? decodeURIComponent(cookieTimezone.split('=')[1]) : null;

        // Set cookie if timezone not set or changed
        if (timezone && timezone !== currentTz) {
            // Set cookie for 1 year
            document.cookie = `timezone=${encodeURIComponent(timezone)}; path=/; max-age=31536000; SameSite=Lax`;
            // Reload to apply new timezone
            window.location.reload();
        }
    })();
</script>