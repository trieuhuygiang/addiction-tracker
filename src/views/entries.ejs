<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        <%= title || 'Chastity Revive Center' %>
    </title>
    </title>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <script src="/js/theme-init.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700;900&family=EB+Garamond:wght@400;500;600;700&family=Crimson+Text:wght@400;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="/css/style.css">
    <style>
        .entries-container {
            max-width: 600px;
            margin: 2rem auto;
            padding: 0 20px;
        }

        .entries-header {
            margin-bottom: 2rem;
        }

        .entries-header h1 {
            color: #667eea;
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .entries-header p {
            color: var(--text-secondary);
            font-size: 1rem;
        }

        .entry-form {
            background: var(--card-bg);
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 2px 10px var(--shadow-color);
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
            font-weight: 600;
        }

        .form-group input[type="date"] {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--input-border);
            border-radius: 5px;
            font-size: 1rem;
            background: var(--input-bg);
            color: var(--text-primary);
        }

        .radio-group {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .radio-option {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 1rem;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            background: var(--bg-secondary);
        }

        .radio-option:hover {
            border-color: var(--info-color);
        }

        .radio-option.clean {
            background-color: rgba(40, 167, 69, 0.1);
        }

        .radio-option.clean:hover,
        .radio-option.clean.selected {
            border-color: var(--success-color);
            background-color: rgba(40, 167, 69, 0.2);
        }

        .radio-option.slip {
            background-color: rgba(255, 193, 7, 0.1);
        }

        .radio-option.slip:hover,
        .radio-option.slip.selected {
            border-color: var(--warning-color);
            background-color: rgba(255, 193, 7, 0.2);
        }

        .radio-option.failed {
            background-color: rgba(220, 53, 69, 0.1);
        }

        .radio-option.failed:hover,
        .radio-option.failed.selected {
            border-color: var(--danger-color);
            background-color: rgba(220, 53, 69, 0.2);
        }

        .radio-option input[type="radio"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .radio-option label {
            margin-bottom: 0;
            cursor: pointer;
            font-weight: 600;
            font-size: 1.1rem;
        }

        .radio-option .description {
            font-size: 0.85rem;
            color: var(--text-secondary);
            font-weight: normal;
        }

        .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--input-border);
            border-radius: 5px;
            font-size: 1rem;
            font-family: inherit;
            min-height: 120px;
            resize: vertical;
            background: var(--input-bg);
            color: var(--text-primary);
        }

        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 5px rgba(102, 126, 234, 0.3);
        }

        .success-message {
            background-color: #d4edda;
            color: #155724;
            padding: 0.75rem;
            border-radius: 5px;
            margin-bottom: 1.5rem;
            border: 1px solid #c3e6cb;
        }

        .error-message {
            background-color: #f8d7da;
            color: #721c24;
            padding: 0.75rem;
            border-radius: 5px;
            margin-bottom: 1.5rem;
            border: 1px solid #f5c6cb;
        }

        .form-buttons {
            display: flex;
            gap: 1rem;
        }

        .submit-btn {
            flex: 1;
            padding: 0.75rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .delete-btn {
            padding: 0.75rem 1.5rem;
            background-color: #e74c3c;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .delete-btn:hover {
            background-color: #c0392b;
        }

        .back-link {
            display: inline-block;
            margin-top: 1rem;
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
        }

        .back-link:hover {
            text-decoration: underline;
        }

        .date-navigation {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 1rem;
        }

        .date-nav-btn {
            padding: 0.5rem 1rem;
            background-color: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
            border-radius: 5px;
            cursor: pointer;
            text-decoration: none;
            font-weight: 600;
            transition: background-color 0.3s;
        }

        .date-nav-btn:hover {
            background-color: var(--bg-secondary);
            border-color: var(--info-color);
        }

        /* Mobile Responsive Styles */
        @media (max-width: 768px) {
            .entries-container {
                padding: 0 15px;
                margin: 1rem auto;
            }

            .entries-header {
                margin-bottom: 1.5rem;
                text-align: center;
            }

            .entries-header h1 {
                font-size: 1.5rem;
            }

            .entries-header p {
                font-size: 0.9rem;
            }

            .entry-form {
                padding: 1.25rem;
            }

            .form-group {
                margin-bottom: 1.25rem;
            }

            .radio-option {
                padding: 1rem;
            }

            .radio-option label {
                font-size: 1rem;
            }

            .form-buttons {
                flex-direction: column;
                gap: 0.75rem;
            }

            .submit-btn,
            .delete-btn {
                width: 100%;
                padding: 1rem;
            }

            .date-navigation {
                flex-wrap: wrap;
                gap: 0.5rem;
            }

            .date-nav-btn {
                flex: 1;
                min-width: 80px;
                text-align: center;
                padding: 0.75rem 0.5rem;
                font-size: 0.85rem;
            }
        }

        @media (max-width: 480px) {
            .entries-header h1 {
                font-size: 1.25rem;
            }

            .radio-option {
                padding: 0.875rem;
            }

            .radio-option label {
                font-size: 0.95rem;
            }

            .radio-option .description {
                font-size: 0.8rem;
            }
        }
    </style>
</head>

<body>
    <%- include('partials/header') %>

        <div class="entries-container">
            <div class="entries-header">
                <h1>üìù Log Entry</h1>
                <p>Track your daily progress</p>
            </div>

            <div class="entry-form">
                <% if (error) { %>
                    <div class="error-message">
                        <%= error %>
                    </div>
                    <% } %>

                        <% if (locals.success) { %>
                            <div class="success-message">
                                <%= success %>
                            </div>
                            <% } %>

                                <form method="POST" action="/entries">
                                    <div class="form-group">
                                        <label for="date">Date</label>
                                        <input type="date" id="date" name="date" value="<%= date %>" required>
                                    </div>

                                    <div class="form-group">
                                        <label>Today's Status</label>
                                        <div class="radio-group">
                                            <div class="radio-option clean"
                                                onclick="this.querySelector('input').checked = true; updateSelection()">
                                                <input type="radio" id="clean" name="failureLevel" value="0" <% if
                                                    (!entry || (!entry.had_leakage && (!entry.failure_level ||
                                                    entry.failure_level===0))) { %>checked<% } %> required>
                                                    <label for="clean">
                                                        ‚úÖ Clean Day
                                                        <div class="description">Completely clean today</div>
                                                    </label>
                                            </div>
                                            <div class="radio-option slip"
                                                onclick="this.querySelector('input').checked = true; updateSelection()">
                                                <input type="radio" id="slip" name="failureLevel" value="1" <% if (entry
                                                    && (entry.failure_level===1 || (entry.had_leakage &&
                                                    entry.failure_level !==2))) { %>checked<% } %> required>
                                                    <label for="slip">
                                                        ‚ö†Ô∏è A Little Bit
                                                        <div class="description">Had just a little bit today</div>
                                                    </label>
                                            </div>
                                            <div class="radio-option failed"
                                                onclick="this.querySelector('input').checked = true; updateSelection()">
                                                <input type="radio" id="failed" name="failureLevel" value="2" <% if
                                                    (entry && entry.failure_level===2) { %>checked<% } %> required>
                                                    <label for="failed">
                                                        üíÄ Totally Failed
                                                        <div class="description">Complete failure today</div>
                                                    </label>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label for="note">Notes (optional)</label>
                                        <textarea id="note" name="note"
                                            placeholder="Add any notes about your day..."><% if (entry && entry.note) { %><%= entry.note %><% } %></textarea>
                                    </div>

                                    <div class="form-buttons">
                                        <button type="submit" class="submit-btn">üíæ Save Entry</button>
                                        <% if (entry && entry.id) { %>
                                            <button type="button" class="delete-btn" onclick="deleteEntry()">üóëÔ∏è
                                                Delete</button>
                                            <% } %>
                                    </div>
                                </form>

                                <% if (entry && entry.id) { %>
                                    <form id="deleteForm" method="POST" action="/entries/<%= entry.id %>/delete"
                                        style="display:none;"></form>
                                    <% } %>

                                        <div class="date-navigation">
                                            <a href="#" class="date-nav-btn" onclick="previousDay(); return false;">‚Üê
                                                Previous
                                                Day</a>
                                            <a href="/entries" class="date-nav-btn">Today</a>
                                            <a href="#" class="date-nav-btn" onclick="nextDay(); return false;">Next Day
                                                ‚Üí</a>
                                        </div>

                                        <a href="/dashboard" class="back-link">‚Üê Back to Dashboard</a>
            </div>
        </div>

        <%- include('partials/footer') %>

            <script>
                function updateSelection() {
                    const cleanOption = document.querySelector('.radio-option.clean');
                    const slipOption = document.querySelector('.radio-option.slip');
                    const failedOption = document.querySelector('.radio-option.failed');
                    const cleanRadio = document.getElementById('clean');
                    const slipRadio = document.getElementById('slip');
                    const failedRadio = document.getElementById('failed');

                    cleanOption.classList.remove('selected');
                    slipOption.classList.remove('selected');
                    failedOption.classList.remove('selected');

                    if (cleanRadio.checked) {
                        cleanOption.classList.add('selected');
                    } else if (slipRadio.checked) {
                        slipOption.classList.add('selected');
                    } else if (failedRadio.checked) {
                        failedOption.classList.add('selected');
                    }
                }

                // Initialize selection on page load
                document.addEventListener('DOMContentLoaded', updateSelection);

                function getDateForOffset(offset) {
                    const dateInput = document.getElementById('date').value;
                    const parts = dateInput.split('-');
                    const date = new Date(parts[0], parts[1] - 1, parts[2]);
                    date.setDate(date.getDate() + offset);
                    const year = date.getFullYear();
                    const month = String(date.getMonth() + 1).padStart(2, '0');
                    const day = String(date.getDate()).padStart(2, '0');
                    return `${year}-${month}-${day}`;
                }

                function previousDay() {
                    const newDate = getDateForOffset(-1);
                    window.location.href = '/entries/' + newDate;
                }

                function nextDay() {
                    const newDate = getDateForOffset(1);
                    window.location.href = '/entries/' + newDate;
                }

                function deleteEntry() {
                    if (confirm('Are you sure you want to delete this entry?')) {
                        document.getElementById('deleteForm').submit();
                    }
                }
            </script>
</body>

</html>